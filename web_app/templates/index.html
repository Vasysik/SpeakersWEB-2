<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Website</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

    {% include 'nav_menu.html' %}

    <div class="home-container">
        <div class="bells-container">
            <h1 class="title">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤</h1>
            <ul id="bells-list" class="bells-list">
                {% for bell in bells %}
                <li id="bell-{{ bell.id }}" class="bell-item {% if datetime.strptime(bell.time, '%Y-%m-%d %H:%M:%S') > current_time %}upcoming-bell{% else %}past-bell{% endif %}">
                    <div class="bell-content">
                        <span class="bell-info">{{ bell.info }}</span>
                        <span class="bell-info">–í—Ä–µ–º—è: {{ bell.time }}, –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {{ bell.duration }}, –í—ã–ª–æ–∂–∏–ª: {{ bell.uploaderName }}</span>
                        <audio controls>
                            <source src="/static/audio/{{ bell.audioFile }}" type="audio/mp3">
                            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ-—ç–ª–µ–º–µ–Ω—Ç.
                        </audio>
                    </div>
                    <div class="delete-button-container">
                        <form id="delete-form-{{ bell.id }}" action="{{ url_for('delete_bell', bell_id=bell.id) }}" method="POST" class="delete-form">
                            <button type="submit" class="btn" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–≤–æ–Ω–æ–∫?')">
                                üóëÔ∏è
                            </button>
                        </form>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="create-bell-container">
            {% if username %}
                <h1 class="title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫</h1>
                <form action="{{ url_for('create_bell') }}" method="POST" enctype="multipart/form-data">
                    <div class="form-group">
                        <label>–í—Ä–µ–º—è:</label>
                        <input type="datetime-local" name="time" value="{% if newBell %}{{ newBell.time }}{% endif %}" onChange="(e) => setNewBell({ ...newBell, time: e.target.value })" step="1" required pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}">
                    </div>
                    <div class="form-group">
                        <label>–ê—É–¥–∏–æ—Ñ–∞–π–ª:</label>
                        <label class="custom-file-upload">
                            <span id="selectedFileName">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                            <input type="file" id="audioFileInput" name="audio" accept="audio/*" required>
                        </label>
                    </div>
                    <div class="form-group">
                        <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</label>
                        <input type="text" id="audioDuration" value="{% if newBell %}{{ newBell.duration }}{% endif %}" disabled>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <input type="text" name="info" value="{% if newBell %}{{ newBell.info }}{% endif %}" onChange="(e) => setNewBell({ ...newBell, info: e.target.value })" required>
                    </div>
                    <div class="form-group">
                        <label>–í—ã–ª–æ–∂–∏–ª:</label>
                        <input type="text" value="{% if newBell %}{{ newBell.uploaderName }}{% endif %}" disabled>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="button btn">–°–æ–∑–¥–∞—Ç—å –∑–≤–æ–Ω–æ–∫</button>
                        <button type="button" class="button emergency-button btn btn-danger">–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –∑–≤–æ–Ω–æ–∫</button>
                    </div>
                </form>
            {% else %}
                <p>–í—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∑–≤–æ–Ω–∫–∏. <a href="{{ url_for('login') }}">–í–æ–π–¥–∏—Ç–µ</a>.</p>
            {% endif %}
        </div>
    </div>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Bootstrap JS –∏ –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- JavaScript –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞ -->
    <script>
        document.getElementById('audioFileInput').addEventListener('change', function() {
            var selectedFile = this.files[0];
            var selectedFileName = selectedFile ? selectedFile.name : '–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª';
            document.getElementById('selectedFileName').textContent = selectedFileName;
    
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞
            var audio = new Audio();
            audio.src = URL.createObjectURL(selectedFile);
            audio.addEventListener('loadedmetadata', function() {
                var duration = audio.duration;
                var hours = Math.floor(duration / 3600);
                var minutes = Math.floor((duration % 3600) / 60);
                var seconds = Math.floor(duration % 60);
                document.getElementById('audioDuration').value = hours + ':' + ('0' + minutes).slice(-2) + ':' + ('0' + seconds).slice(-2);
            });
        });
        document.addEventListener("DOMContentLoaded", function() {
            const bellsList = document.querySelector("#bells-list");
            const upcomingBells = bellsList.querySelectorAll(".upcoming-bell");

            if (upcomingBells.length > 0) {
                const closestUpcomingBell = upcomingBells[0];
                closestUpcomingBell.scrollIntoView({ behavior: "smooth", block: "start" });
            }
        });
    </script>
</body>
</html>
